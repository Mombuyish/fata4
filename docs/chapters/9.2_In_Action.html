
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>9.2 In Action 实践 · Laravel - 从百草园到三味书屋</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="original Taylor Otwell, translate zgldh">
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    
    <link rel="prev" href="9.1_Introduction.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="Author's_Note.html">
            
                <a href="Author's_Note.html">
            
                    
                    Author's Note 作者自序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    1 Dependency Injection 依赖注入
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="1.1_The_Problem.html">
            
                <a href="1.1_The_Problem.html">
            
                    
                    1.1 The Problem 遇到的问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="1.2_Build_A_Contract.html">
            
                <a href="1.2_Build_A_Contract.html">
            
                    
                    1.2 Build A Contract 建立约定
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="1.3_Take_It_further.html">
            
                <a href="1.3_Take_It_further.html">
            
                    
                    1.3 Take It further 更进一步
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="1.4_Too_Much_Java.html">
            
                <a href="1.4_Too_Much_Java.html">
            
                    
                    1.4 Too Much Java? 太像Java了？
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    2 The IoC Container 控制反转容器
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="2.1_Basic_Binding.html">
            
                <a href="2.1_Basic_Binding.html">
            
                    
                    2.1 Basic Binding 基础绑定
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="2.2_Reflective_Resolution.html">
            
                <a href="2.2_Reflective_Resolution.html">
            
                    
                    2.2 Reflective Resolution 反射解决方案
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" >
            
                <span>
            
                    
                    3 Interface As Contract 接口约定
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="3.1_Strong_Typing_&_Water_Fowl.html">
            
                <a href="3.1_Strong_Typing_&_Water_Fowl.html">
            
                    
                    3.1 Strong Typing & Water Fowl 强类型和小鸭子
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="3.2_A_Contract_Example.html">
            
                <a href="3.2_A_Contract_Example.html">
            
                    
                    3.2 A Contract Example 约定的范例
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="3.3_Interface_&_Team_Development.html">
            
                <a href="3.3_Interface_&_Team_Development.html">
            
                    
                    3.3 Interface & Team Development 接口与团队开发
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" >
            
                <span>
            
                    
                    4 Service Provider 服务提供者
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="4.1_As_Bootstrapper.html">
            
                <a href="4.1_As_Bootstrapper.html">
            
                    
                    4.1 As Bootstrapper 他是引导程序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="4.2_As_Organizer.html">
            
                <a href="4.2_As_Organizer.html">
            
                    
                    4.2 As Organizer 作为管理工具
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="4.3_Booting_Providers.html">
            
                <a href="4.3_Booting_Providers.html">
            
                    
                    4.3 Booting Providers 服务提供者的启动过程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="4.4_Providing_The_Core.html">
            
                <a href="4.4_Providing_The_Core.html">
            
                    
                    4.4 Providing The Core 核心也是服务提供者的模式
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" >
            
                <span>
            
                    
                    5 Application Structure 应用结构
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="5.1_Introduction.html">
            
                <a href="5.1_Introduction.html">
            
                    
                    5.1 Introduction 介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="5.2_MVC_Is_Killing_You.html">
            
                <a href="5.2_MVC_Is_Killing_You.html">
            
                    
                    5.2 MVC Is Killing You MVC是慢性谋杀
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="5.3_Bye_Models.html">
            
                <a href="5.3_Bye_Models.html">
            
                    
                    5.3 Bye, Bye Models 再见，模型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="5.4_It's_All_About_The_Layers.html">
            
                <a href="5.4_It's_All_About_The_Layers.html">
            
                    
                    5.4 It's All About The Layers 核心思想就是分层
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.5" data-path="5.5_Where_To_Put_Stuff.html">
            
                <a href="5.5_Where_To_Put_Stuff.html">
            
                    
                    5.5 Where To Put "Stuff" 东西都放哪儿？
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" >
            
                <span>
            
                    
                    6 Applied Architecture: Decoupling Handles 实用做法：解耦处理函数
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="6.1_Introduction.html">
            
                <a href="6.1_Introduction.html">
            
                    
                    6.1 Introduction 介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="6.2_Decoupling_Handlers.html">
            
                <a href="6.2_Decoupling_Handlers.html">
            
                    
                    6.2 Decoupling Handlers 解耦处理函数
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="6.3_Other_Handlers.html">
            
                <a href="6.3_Other_Handlers.html">
            
                    
                    6.3 Other Handlers 其他处理函数
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" >
            
                <span>
            
                    
                    7 Extending The Framework 扩展框架
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="7.1_Introduction.html">
            
                <a href="7.1_Introduction.html">
            
                    
                    7.1 Introduction 介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="7.2_Managers_&_Factories.html">
            
                <a href="7.2_Managers_&_Factories.html">
            
                    
                    7.2 Managers & Factories 管理者和工厂
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="7.3_Cache.html">
            
                <a href="7.3_Cache.html">
            
                    
                    7.3 Cache 缓存
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.4" data-path="7.4_Session.html">
            
                <a href="7.4_Session.html">
            
                    
                    7.4 Session 会话
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.5" data-path="7.5_Authentication.html">
            
                <a href="7.5_Authentication.html">
            
                    
                    7.5 Authentication 身份认证
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.6" data-path="7.6_IoC_Based_Extension.html">
            
                <a href="7.6_IoC_Based_Extension.html">
            
                    
                    7.6 IoC Based Extension 使用容器进行扩展
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.7" data-path="7.7_Request_Extension.html">
            
                <a href="7.7_Request_Extension.html">
            
                    
                    7.7 Request Extension 请求的扩展
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" >
            
                <span>
            
                    
                    8 Single Responsibility Principle 单一职责原则
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="8.1_Introduction.html">
            
                <a href="8.1_Introduction.html">
            
                    
                    8.1 Introduction 介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="8.2_In_Action.html">
            
                <a href="8.2_In_Action.html">
            
                    
                    8.2 In Action 实践
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" >
            
                <span>
            
                    
                    9 Open Closed Principle 开放封闭原则
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1" data-path="9.1_Introduction.html">
            
                <a href="9.1_Introduction.html">
            
                    
                    9.1 Introduction 介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.11.2" data-path="9.2_In_Action.html">
            
                <a href="9.2_In_Action.html">
            
                    
                    9.2 In Action 实践
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.12" >
            
                <span>
            
                    
                    10 Liskov Substitution Principle 里氏替换原则
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.12.1" data-path="10.1_Introduction.html">
            
                <a href="10.1_Introduction.html">
            
                    
                    10.1 Introduction 介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.2" data-path="10.2_In_Action.html">
            
                <a href="10.2_In_Action.html">
            
                    
                    10.2 In Action 实践
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.13" >
            
                <span>
            
                    
                    11 Interface Segregation Principle 接口隔离原则
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.13.1" data-path="11.1_Introduction.html">
            
                <a href="11.1_Introduction.html">
            
                    
                    11.1 Introduction 介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.2" data-path="11.2_In_Action.html">
            
                <a href="11.2_In_Action.html">
            
                    
                    11.2 In Action 实践
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.14" >
            
                <span>
            
                    
                    12 Dependency Inversion Principle 依赖反转原则
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.14.1" data-path="12.1_Introduction.html">
            
                <a href="12.1_Introduction.html">
            
                    
                    12.1 Introduction 介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.2" data-path="12.2_In_Action.html">
            
                <a href="12.2_In_Action.html">
            
                    
                    12.2 In Action 实践
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            本书使用 GitBook 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >9.2 In Action 实践</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="in-action-&#x5B9E;&#x8DF5;">In Action &#x5B9E;&#x8DF5;</h1>
<p>To demonstrate the Open Closed principle, let&apos;s continue working with our OrderProcessor from the previous chapter. Consider the following section of the process method:</p>
<p>&#x4E3A;&#x4E86;&#x6F14;&#x793A;&#x5F00;&#x653E;&#x5C01;&#x95ED;&#x539F;&#x5219;&#xFF0C;&#x6211;&#x4EEC;&#x6765;&#x7EE7;&#x7EED;&#x7F16;&#x5199;&#x4E0A;&#x4E00;&#x7AE0;&#x8282;&#x7684; OrderProcecssor&#x3002;&#x8003;&#x8651;&#x4E0B;&#x9762;&#x7684; process &#x65B9;&#x6CD5;&#xFF1A;</p>
<pre><code class="lang-php">$recent = $this-&gt;orders-&gt;getRecentOrderCount($order-&gt;account);

<span class="hljs-keyword">if</span>($recent &gt; <span class="hljs-number">0</span>)
{
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-keyword">Exception</span>(<span class="hljs-string">&apos;Duplicate order likely.&apos;</span>);
}
</code></pre>
<p>This code is quite readable, and even easy to test since we are properly using dependency injection. However, what if our business rules regarding order validation change? What if we get new rules? In fact, what if, as our business grows, we get many new rules? Our process method will quickly grow into a beast of spaghetti code that is hard to maintain. Because this code must be changed each time our business rules change, it is open for modification and violates the Open Closed principle. Remember, we want our code to be open for extension, not modification.</p>
<p>&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x53EF;&#x8BFB;&#x6027;&#x5F88;&#x9AD8;&#xFF0C;&#x4E14;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x4E86;&#x4F9D;&#x8D56;&#x6CE8;&#x5165;&#xFF0C;&#x53D8;&#x5F97;&#x5F88;&#x5BB9;&#x6613;&#x6D4B;&#x8BD5;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x5224;&#x65AD;&#x8BA2;&#x5355;&#x7684;&#x89C4;&#x5219;&#x6539;&#x53D8;&#x4E86;&#x5462;&#xFF1F;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x53C8;&#x6709;&#x65B0;&#x7684;&#x89C4;&#x5219;&#x4E86;&#x5462;&#xFF1F;&#x66F4;&#x8FDB;&#x4E00;&#x6B65;&#xFF0C;&#x5982;&#x679C;&#x968F;&#x7740;&#x6211;&#x4EEC;&#x7684;&#x4E1A;&#x52A1;&#x53D1;&#x5C55;&#xFF0C;&#x8981;&#x589E;&#x52A0;&#x4E00;&#x5927;&#x5806;&#x65B0;&#x89C4;&#x5219;&#x5462;&#xFF1F;&#x90A3;&#x6211;&#x4EEC;&#x7684; process &#x65B9;&#x6CD5;&#x4F1A;&#x5F88;&#x5FEB;&#x53D8;&#x6210;&#x4E00;&#x5768;&#x96BE;&#x4EE5;&#x7EF4;&#x62A4;&#x7684;&#x6D46;&#x7CCA;&#x3002;&#x56E0;&#x4E3A;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x5FC5;&#x987B;&#x968F;&#x7740;&#x6BCF;&#x6B21;&#x4E1A;&#x52A1;&#x903B;&#x8F91;&#x7684;&#x6539;&#x53D8;&#x800C;&#x8DDF;&#x7740;&#x6539;&#x53D8;&#xFF0C;&#x5B83;&#x5BF9;&#x4FEE;&#x6539;&#x662F;&#x5F00;&#x653E;&#x7684;&#xFF0C;&#x8FD9;&#x8FDD;&#x53CD;&#x4E86;&#x5F00;&#x653E;&#x5C01;&#x95ED;&#x539F;&#x5219;&#x3002;&#x8BB0;&#x4F4F;&#xFF0C;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x4EE3;&#x7801;&#x5BF9;&#x6269;&#x5C55;&#x5F00;&#x653E;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x4FEE;&#x6539;&#x3002;</p>
<p>Instead of performing all of our order validation directly inside the process method, let&apos;s define a new interface: OrderValidator:</p>
<p>&#x4E0D;&#x5FC5;&#x518D;&#x628A;&#x8BA2;&#x5355;&#x9A8C;&#x8BC1;&#x76F4;&#x63A5;&#x5199;&#x5728; process &#x65B9;&#x6CD5;&#x91CC;&#x9762;&#xFF0C;&#x6211;&#x4EEC;&#x6765;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x63A5;&#x53E3;&#xFF1A;OrderValidator&#xFF1A;</p>
<pre><code class="lang-php"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">OrderValidatorInterface</span> </span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">validate</span><span class="hljs-params">(Order $order)</span></span>;
}
</code></pre>
<p>Next, let&apos;s define an implementation that protects against duplicate orders:</p>
<p>&#x4E0B;&#x4E00;&#x6B65;&#x6211;&#x4EEC;&#x6765;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x5B9E;&#x73B0;&#x63A5;&#x53E3;&#x7684;&#x7C7B;&#xFF0C;&#x6765;&#x9884;&#x9632;&#x91CD;&#x590D;&#x8BA2;&#x5355;&#xFF1A;</p>
<pre><code class="lang-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RecentOrderValidator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">OrderValidatorInterface</span> </span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">(OrderRepository $orders)</span>
    </span>{
        $this-&gt;orders = $orders;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">validate</span><span class="hljs-params">(Order $order)</span>
    </span>{
        $recent = $this-&gt;orders-&gt;getRecentOrderCount($order-&gt;account);
        <span class="hljs-keyword">if</span>($recent &gt; <span class="hljs-number">0</span>)
        {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-keyword">Exception</span>(<span class="hljs-string">&apos;Duplicate order likely.&apos;</span>);
        }
    }
}
</code></pre>
<p>Great! Now we have a small, testable encapsulation of a single business rule. Let&apos;s create another implementation that verifies the account is not suspended:</p>
<p>&#x5F88;&#x597D;&#xFF01;&#x6211;&#x4EEC;&#x5C01;&#x88C5;&#x4E86;&#x4E00;&#x4E2A;&#x5C0F;&#x5DE7;&#x7684;&#x3001;&#x53EF;&#x6D4B;&#x8BD5;&#x7684;&#x5355;&#x4E00;&#x4E1A;&#x52A1;&#x903B;&#x8F91;&#x3002;&#x54B1;&#x4EEC;&#x6765;&#x518D;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x6765;&#x9A8C;&#x8BC1;&#x8D26;&#x53F7;&#x662F;&#x5426;&#x505C;&#x7528;&#x5427;&#xFF1A;</p>
<pre><code class="lang-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SuspendedAccountValidator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">OrderValidatorInterface</span> </span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">validate</span><span class="hljs-params">(Order $order)</span>
    </span>{
        <span class="hljs-keyword">if</span>($order-&gt;account-&gt;isSuspended())
        {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-keyword">Exception</span>(<span class="hljs-string">&quot;Suspended accounts may not order.&quot;</span>);
        }
    }
}
</code></pre>
<p>Now that we have two different implementations of our OrderValidatorInterface, let&apos;s use them within our OrderProcessor. We&apos;ll simply inject an array of validators into the processor instance, which will allow us to easily add and remove validation rules as our codebase evolves.</p>
<p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x6709;&#x4E24;&#x4E2A;&#x4E0D;&#x540C;&#x7684;&#x7C7B;&#x5B9E;&#x73B0;&#x4E86;OrderValidatorInterface&#x63A5;&#x53E3;&#x3002;&#x54B1;&#x4EEC;&#x5C06;&#x5728;OrderProcessor&#x91CC;&#x9762;&#x4F7F;&#x7528;&#x5B83;&#x4EEC;&#x3002;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x7B80;&#x5355;&#x7684;&#x5C06;&#x4E00;&#x4E2A;&#x9A8C;&#x8BC1;&#x5668;&#x6570;&#x7EC4;&#x6CE8;&#x5165;&#x8FDB;&#x8BA2;&#x5355;&#x5904;&#x7406;&#x5668;&#x5B9E;&#x4F8B;&#x4E2D;&#x3002;&#x8FD9;&#x5C06;&#x4F7F;&#x6211;&#x4EEC;&#x4EE5;&#x540E;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x65F6;&#x80FD;&#x8F7B;&#x677E;&#x7684;&#x6DFB;&#x52A0;&#x548C;&#x5220;&#x9664;&#x9A8C;&#x8BC1;&#x5668;&#x89C4;&#x5219;&#x3002;</p>
<pre><code class="lang-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OrderProcessor</span> </span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">(BillerInterface $biller, OrderRepository $orders, array $validators = array<span class="hljs-params">()</span>)</span>
    </span>{
        $this-&gt;biller = $bller;
        $this-&gt;orders = $orders;
        $this-&gt;validators = $validators;
    }
}
</code></pre>
<p>Next, we can simply loop through the validators in the process method:</p>
<p>&#x7136;&#x540E;&#x6211;&#x4EEC;&#x53EA;&#x8981;&#x5728; process &#x65B9;&#x6CD5;&#x91CC;&#x9762;&#x5FAA;&#x73AF;&#x8FD9;&#x4E2A;&#x9A8C;&#x8BC1;&#x5668;&#x6570;&#x7EC4;&#x5373;&#x53EF;&#xFF1A;</p>
<pre><code class="lang-php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">process</span><span class="hljs-params">(Order $order)</span>
</span>{
    <span class="hljs-keyword">foreach</span>($this-&gt;validators <span class="hljs-keyword">as</span> $validator)
    {
        $validator-&gt;validate($order);
    }

    <span class="hljs-comment">// Process valid order...</span>
}
</code></pre>
<p>Finally, we will register our OrderProcessor class in the application IoC container:</p>
<p>&#x6700;&#x540E;&#x6211;&#x4EEC;&#x5728; IoC &#x5BB9;&#x5668;&#x91CC;&#x9762;&#x6CE8;&#x518C; OrderProcessor &#x7C7B;&#xFF1A;</p>
<pre><code class="lang-php">App::bind(<span class="hljs-string">&apos;OrderProcessor&apos;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> OrderProcessor(
        App::make(<span class="hljs-string">&apos;BillerInterface&apos;</span>),
        App::make(<span class="hljs-string">&apos;OrderRepository&apos;</span>),
        <span class="hljs-keyword">array</span>(
            App::make(<span class="hljs-string">&apos;RecentOrderValidator&apos;</span>),
            App::make(<span class="hljs-string">&apos;SuspendedAccountValidator&apos;</span>)
        )
    );
});
</code></pre>
<p>With these few changes, which took only minimal effort to build from our existing codebase, we can now add and remove new validation rules without modifying a single line of existing code. Each new validation rule is simply a new implementation of the OrderValidatorInterface, and is registered with the IoC container. Instead of unit testing a large, unwieldy process method, we can now test each validation rule in isolation. Our code is now open for extension, but closed for modification.</p>
<p>&#x5728;&#x73B0;&#x6709;&#x4EE3;&#x7801;&#x91CC;&#x4ED8;&#x51FA;&#x4E9B;&#x5C0F;&#x52AA;&#x529B;&#xFF0C;&#x505A;&#x4E00;&#x4E9B;&#x5C0F;&#x6539;&#x52A8;&#x4E4B;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x6DFB;&#x52A0;&#x5220;&#x9664;&#x65B0;&#x7684;&#x9A8C;&#x8BC1;&#x89C4;&#x5219;&#x800C;&#x4E0D;&#x5FC5;&#x4FEE;&#x6539;&#x4EFB;&#x4F55;&#x4E00;&#x884C;&#x73B0;&#x6709;&#x4EE3;&#x7801;&#x4E86;&#x3002;&#x6BCF;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x9A8C;&#x8BC1;&#x89C4;&#x5219;&#x5C31;&#x662F;&#x5BF9; OrderValidatorInterface &#x7684;&#x4E00;&#x4E2A;&#x5B9E;&#x73B0;&#x7C7B;&#xFF0C;&#x7136;&#x540E;&#x6CE8;&#x518C;&#x8FDB;IoC&#x5BB9;&#x5668;&#x91CC;&#x3002;&#x4E0D;&#x5FC5;&#x518D;&#x4E3A;&#x90A3;&#x4E2A;&#x53C8;&#x5927;&#x53C8;&#x7B28;&#x7684; process &#x65B9;&#x6CD5;&#x505A;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x4E86;&#xFF0C;&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x5355;&#x72EC;&#x6D4B;&#x8BD5;&#x6BCF;&#x4E00;&#x4E2A;&#x9A8C;&#x8BC1;&#x89C4;&#x5219;&#x3002;&#x73B0;&#x5728;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x4EE3;&#x7801;&#x5BF9;&#x6269;&#x5C55;&#x662F;&#x5F00;&#x653E;&#x7684;&#xFF0C;&#x5BF9;&#x4FEE;&#x6539;&#x662F;&#x5C01;&#x95ED;&#x7684;&#x3002;</p>
<blockquote>
<h3 id="leaky-abstractions-&#x62BD;&#x8C61;&#x7684;&#x6F0F;&#x6D1E;">Leaky Abstractions &#x62BD;&#x8C61;&#x7684;&#x6F0F;&#x6D1E;</h3>
<p>Watch out for dependencies that leak implementation details. An implementation change in a dependency should not require any changes by its consumer. When changes to the consumer are required, it is said that the dependency is &quot;leaking&quot; implementation details. When your abstractions are leaky, the Open Closed principle has likely been broken.</p>
<p>&#x5C0F;&#x5FC3;&#x90A3;&#x4E9B;&#x7F3A;&#x5C11;&#x5B9E;&#x73B0;&#x7EC6;&#x8282;&#x7684;&#x4F9D;&#x8D56;&#xFF08;&#x8BD1;&#x8005;&#x6CE8;&#xFF1A;&#x6BD4;&#x5982;&#x4E0A;&#x9762;&#x7684; RecentOrderValidator &#xFF09;&#x3002;&#x5F53;&#x4E00;&#x4E2A;&#x4F9D;&#x8D56;&#x7684;&#x5B9E;&#x73B0;&#x9700;&#x8981;&#x6539;&#x53D8;&#x65F6;&#xFF0C;&#x4E0D;&#x5E94;&#x8BE5;&#x8981;&#x6C42;&#x5B83;&#x7684;&#x8C03;&#x7528;&#x8005;&#x505A;&#x4EFB;&#x4F55;&#x4FEE;&#x6539;&#x3002;&#x5F53;&#x9700;&#x8981;&#x8C03;&#x7528;&#x8005;&#x8FDB;&#x884C;&#x4FEE;&#x6539;&#x65F6;&#xFF0C;&#x8FD9;&#x5C31;&#x610F;&#x5473;&#x7740;&#x8BE5;&#x4F9D;&#x8D56;&#x9057;&#x6F0F;&#x4E86;&#x4E00;&#x4E9B;&#x5B9E;&#x73B0;&#x7684;&#x7EC6;&#x8282;&#x3002;&#x5F53;&#x4F60;&#x7684;&#x62BD;&#x8C61;&#x6709;&#x6F0F;&#x6D1E;&#x7684;&#x8BDD;&#xFF0C;&#x5F00;&#x653E;&#x5C01;&#x95ED;&#x539F;&#x5219;&#x5C31;&#x4E0D;&#x7BA1;&#x7528;&#x4E86;&#x3002;</p>
</blockquote>
<p>Before processing further, remember that this principle is not a law. It does not state that every piece of code in your application must be &quot;pluggable&quot;. For instance, a small application that retrieves a few records out of a MySQL database does not warrant a strict adherence to every design principle you can imagine. Do not blindly apply a given design principle out of guilt as you will likely create an over-designed, cumbersome system. Keep in mind that many of these design principles were created to address common architectural problems in large, robust applications. That being said, don&apos;t use this paragraph as an excuse to be lazy!</p>
<p>&#x5728;&#x6211;&#x4EEC;&#x7EE7;&#x7EED;&#x5B66;&#x4E60;&#x524D;&#xFF0C;&#x8981;&#x8BB0;&#x4F4F;&#x8FD9;&#x4E9B;&#x539F;&#x5219;&#x4E0D;&#x662F;&#x6CD5;&#x5F8B;&#x3002;&#x8FD9;&#x4E0D;&#x662F;&#x8BF4;&#x4F60;&#x5E94;&#x7528;&#x4E2D;&#x6BCF;&#x4E00;&#x5757;&#x4EE3;&#x7801;&#x90FD;&#x5E94;&#x8BE5;&#x662F;&#x201C;&#x70ED;&#x63D2;&#x62D4;&#x201D;&#x5F0F;&#x7684;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x4E00;&#x4E2A;&#x4EC5;&#x4EC5;&#x4ECE; MySQL &#x68C0;&#x7D22;&#x51E0;&#x6761;&#x8BB0;&#x5F55;&#x7684;&#x5C0F;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x4E0D;&#x503C;&#x5F97;&#x53BB;&#x4E25;&#x683C;&#x9075;&#x5B88;&#x6BCF;&#x4E00;&#x6761;&#x4F60;&#x60F3;&#x5230;&#x7684;&#x8BBE;&#x8BA1;&#x539F;&#x5219;&#x3002;&#x4E0D;&#x8981;&#x76F2;&#x76EE;&#x7684;&#x5E94;&#x7528;&#x8BBE;&#x8BA1;&#x539F;&#x5219;&#xFF0C;&#x90A3;&#x6837;&#x4F60;&#x4F1A;&#x9020;&#x51FA;&#x4E00;&#x4E2A;&#x201C;&#x8FC7;&#x5EA6;&#x8BBE;&#x8BA1;&#x201D;&#x7684;&#x7E41;&#x7410;&#x7684;&#x7CFB;&#x7EDF;&#x3002;&#x8BB0;&#x4F4F;&#x8FD9;&#x4E9B;&#x8BBE;&#x8BA1;&#x539F;&#x5219;&#x662F;&#x7528;&#x6765;&#x89E3;&#x51B3;&#x901A;&#x7528;&#x7684;&#x67B6;&#x6784;&#x95EE;&#x9898;&#xFF0C;&#x5236;&#x9020;&#x5927;&#x578B;&#x5BB9;&#x9519;&#x80FD;&#x529B;&#x5F3A;&#x7684;&#x5E94;&#x7528;&#x3002;&#x6211;&#x5C31;&#x8FD9;&#x4E48;&#x4E00;&#x8BF4;&#xFF0C;&#x4F60;&#x53EF;&#x522B;&#x628A;&#x5B83;&#x5F53;&#x4F5C;&#x61D2;&#x60F0;&#x7684;&#x501F;&#x53E3;&#xFF01;</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="9.1_Introduction.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page: 9.1 Introduction 介绍">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"9.2 In Action 实践","level":"1.11.2","depth":2,"next":{"title":"10 Liskov Substitution Principle 里氏替换原则","level":"1.12","depth":1,"ref":"","articles":[{"title":"10.1 Introduction 介绍","level":"1.12.1","depth":2,"path":"chapters/10.1_Introduction.md","ref":"./chapters/10.1_Introduction.md","articles":[]},{"title":"10.2 In Action 实践","level":"1.12.2","depth":2,"path":"chapters/10.2_In_Action.md","ref":"./chapters/10.2_In_Action.md","articles":[]}]},"previous":{"title":"9.1 Introduction 介绍","level":"1.11.1","depth":2,"path":"chapters/9.1_Introduction.md","ref":"./chapters/9.1_Introduction.md","articles":[]},"dir":"ltr"},"config":{"plugins":[],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","author":"original Taylor Otwell, translate zgldh","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"Laravel - 从百草园到三味书屋","language":"zh-hans","gitbook":"*"},"file":{"path":"chapters/9.2_In_Action.md","mtime":"2019-01-07T16:04:27.052Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2019-01-07T16:06:05.085Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

