
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>10.2 In Action 实践 · Laravel - 从百草园到三味书屋</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="original Taylor Otwell, translate zgldh">
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    
    <link rel="prev" href="10.1_Introduction.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="Author's_Note.html">
            
                <a href="Author's_Note.html">
            
                    
                    Author's Note 作者自序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    1 Dependency Injection 依赖注入
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="1.1_The_Problem.html">
            
                <a href="1.1_The_Problem.html">
            
                    
                    1.1 The Problem 遇到的问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="1.2_Build_A_Contract.html">
            
                <a href="1.2_Build_A_Contract.html">
            
                    
                    1.2 Build A Contract 建立约定
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="1.3_Take_It_further.html">
            
                <a href="1.3_Take_It_further.html">
            
                    
                    1.3 Take It further 更进一步
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="1.4_Too_Much_Java.html">
            
                <a href="1.4_Too_Much_Java.html">
            
                    
                    1.4 Too Much Java? 太像Java了？
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    2 The IoC Container 控制反转容器
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="2.1_Basic_Binding.html">
            
                <a href="2.1_Basic_Binding.html">
            
                    
                    2.1 Basic Binding 基础绑定
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="2.2_Reflective_Resolution.html">
            
                <a href="2.2_Reflective_Resolution.html">
            
                    
                    2.2 Reflective Resolution 反射解决方案
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" >
            
                <span>
            
                    
                    3 Interface As Contract 接口约定
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="3.1_Strong_Typing_&_Water_Fowl.html">
            
                <a href="3.1_Strong_Typing_&_Water_Fowl.html">
            
                    
                    3.1 Strong Typing & Water Fowl 强类型和小鸭子
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="3.2_A_Contract_Example.html">
            
                <a href="3.2_A_Contract_Example.html">
            
                    
                    3.2 A Contract Example 约定的范例
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="3.3_Interface_&_Team_Development.html">
            
                <a href="3.3_Interface_&_Team_Development.html">
            
                    
                    3.3 Interface & Team Development 接口与团队开发
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" >
            
                <span>
            
                    
                    4 Service Provider 服务提供者
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="4.1_As_Bootstrapper.html">
            
                <a href="4.1_As_Bootstrapper.html">
            
                    
                    4.1 As Bootstrapper 他是引导程序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="4.2_As_Organizer.html">
            
                <a href="4.2_As_Organizer.html">
            
                    
                    4.2 As Organizer 作为管理工具
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="4.3_Booting_Providers.html">
            
                <a href="4.3_Booting_Providers.html">
            
                    
                    4.3 Booting Providers 服务提供者的启动过程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="4.4_Providing_The_Core.html">
            
                <a href="4.4_Providing_The_Core.html">
            
                    
                    4.4 Providing The Core 核心也是服务提供者的模式
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" >
            
                <span>
            
                    
                    5 Application Structure 应用结构
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="5.1_Introduction.html">
            
                <a href="5.1_Introduction.html">
            
                    
                    5.1 Introduction 介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="5.2_MVC_Is_Killing_You.html">
            
                <a href="5.2_MVC_Is_Killing_You.html">
            
                    
                    5.2 MVC Is Killing You MVC是慢性谋杀
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="5.3_Bye_Models.html">
            
                <a href="5.3_Bye_Models.html">
            
                    
                    5.3 Bye, Bye Models 再见，模型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="5.4_It's_All_About_The_Layers.html">
            
                <a href="5.4_It's_All_About_The_Layers.html">
            
                    
                    5.4 It's All About The Layers 核心思想就是分层
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.5" data-path="5.5_Where_To_Put_Stuff.html">
            
                <a href="5.5_Where_To_Put_Stuff.html">
            
                    
                    5.5 Where To Put "Stuff" 东西都放哪儿？
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" >
            
                <span>
            
                    
                    6 Applied Architecture: Decoupling Handles 实用做法：解耦处理函数
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="6.1_Introduction.html">
            
                <a href="6.1_Introduction.html">
            
                    
                    6.1 Introduction 介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="6.2_Decoupling_Handlers.html">
            
                <a href="6.2_Decoupling_Handlers.html">
            
                    
                    6.2 Decoupling Handlers 解耦处理函数
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="6.3_Other_Handlers.html">
            
                <a href="6.3_Other_Handlers.html">
            
                    
                    6.3 Other Handlers 其他处理函数
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" >
            
                <span>
            
                    
                    7 Extending The Framework 扩展框架
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="7.1_Introduction.html">
            
                <a href="7.1_Introduction.html">
            
                    
                    7.1 Introduction 介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="7.2_Managers_&_Factories.html">
            
                <a href="7.2_Managers_&_Factories.html">
            
                    
                    7.2 Managers & Factories 管理者和工厂
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="7.3_Cache.html">
            
                <a href="7.3_Cache.html">
            
                    
                    7.3 Cache 缓存
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.4" data-path="7.4_Session.html">
            
                <a href="7.4_Session.html">
            
                    
                    7.4 Session 会话
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.5" data-path="7.5_Authentication.html">
            
                <a href="7.5_Authentication.html">
            
                    
                    7.5 Authentication 身份认证
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.6" data-path="7.6_IoC_Based_Extension.html">
            
                <a href="7.6_IoC_Based_Extension.html">
            
                    
                    7.6 IoC Based Extension 使用容器进行扩展
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.7" data-path="7.7_Request_Extension.html">
            
                <a href="7.7_Request_Extension.html">
            
                    
                    7.7 Request Extension 请求的扩展
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" >
            
                <span>
            
                    
                    8 Single Responsibility Principle 单一职责原则
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="8.1_Introduction.html">
            
                <a href="8.1_Introduction.html">
            
                    
                    8.1 Introduction 介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="8.2_In_Action.html">
            
                <a href="8.2_In_Action.html">
            
                    
                    8.2 In Action 实践
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" >
            
                <span>
            
                    
                    9 Open Closed Principle 开放封闭原则
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1" data-path="9.1_Introduction.html">
            
                <a href="9.1_Introduction.html">
            
                    
                    9.1 Introduction 介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2" data-path="9.2_In_Action.html">
            
                <a href="9.2_In_Action.html">
            
                    
                    9.2 In Action 实践
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.12" >
            
                <span>
            
                    
                    10 Liskov Substitution Principle 里氏替换原则
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.12.1" data-path="10.1_Introduction.html">
            
                <a href="10.1_Introduction.html">
            
                    
                    10.1 Introduction 介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.12.2" data-path="10.2_In_Action.html">
            
                <a href="10.2_In_Action.html">
            
                    
                    10.2 In Action 实践
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.13" >
            
                <span>
            
                    
                    11 Interface Segregation Principle 接口隔离原则
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.13.1" data-path="11.1_Introduction.html">
            
                <a href="11.1_Introduction.html">
            
                    
                    11.1 Introduction 介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.2" data-path="11.2_In_Action.html">
            
                <a href="11.2_In_Action.html">
            
                    
                    11.2 In Action 实践
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.14" >
            
                <span>
            
                    
                    12 Dependency Inversion Principle 依赖反转原则
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.14.1" data-path="12.1_Introduction.html">
            
                <a href="12.1_Introduction.html">
            
                    
                    12.1 Introduction 介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.2" data-path="12.2_In_Action.html">
            
                <a href="12.2_In_Action.html">
            
                    
                    12.2 In Action 实践
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            本书使用 GitBook 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >10.2 In Action 实践</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="in-action-&#x5B9E;&#x8DF5;">In Action &#x5B9E;&#x8DF5;</h1>
<p>To illustrate this principle, let&apos;s continue to use our OrderProcessor example from the previous chapter. Take a look at this method:</p>
<p>&#x4E3A;&#x4E86;&#x8BF4;&#x660E;&#x8BE5;&#x539F;&#x5219;&#xFF0C;&#x6211;&#x4EEC;&#x7EE7;&#x7EED;&#x7F16;&#x5199;&#x4E0A;&#x4E00;&#x7AE0;&#x8282;&#x7684;OrderProcessor&#x3002;&#x770B;&#x4E0B;&#x9762;&#x7684;&#x65B9;&#x6CD5;&#xFF1A;</p>
<pre><code class="lang-php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">process</span><span class="hljs-params">(Order $order)</span>
</span>{
    <span class="hljs-comment">// Validate order...</span>
    $this-&gt;orders-&gt;logOrder($order);
}
</code></pre>
<p>Note that after the Order is validated, we log the order using the OrderReporsitoryInterface implementation. Let&apos;s assume that when our order processing business was young, we stored all of our orders in CSV format on the file system. Our only OrderRepositoryInterface implementation was a CsvOrderRepository. Now, as our order rate grows, we want to use a relational database to store them. So, let&apos;s look at a possible implementation of our new repository:</p>
<p>&#x6CE8;&#x610F;&#x5F53;&#x6211;&#x4EEC;&#x7684; Order &#x901A;&#x8FC7;&#x4E86;&#x9A8C;&#x8BC1;&#xFF0C;&#x5C31;&#x88AB; OrderRepositoryInterface &#x7684;&#x5B9E;&#x73B0;&#x5BF9;&#x8C61;&#x5B58;&#x50A8;&#x8D77;&#x6765;&#x4E86;&#x3002;&#x5047;&#x8BBE;&#x5F53;&#x6211;&#x4EEC;&#x7684;&#x4E1A;&#x52A1;&#x521A;&#x8D77;&#x6B65;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x8BA2;&#x5355;&#x5B58;&#x50A8;&#x5728; CSV &#x683C;&#x5F0F;&#x7684;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x4E2D;&#x3002;&#x6211;&#x4EEC;&#x7684; OrderRepositoryInterface &#x7684;&#x5B9E;&#x73B0;&#x7C7B;&#x662F; CsvOrderRepository&#x3002;&#x73B0;&#x5728;&#xFF0C;&#x968F;&#x7740;&#x6211;&#x4EEC;&#x8BA2;&#x5355;&#x589E;&#x591A;&#xFF0C;&#x6211;&#x4EEC;&#x60F3;&#x7528;&#x4E00;&#x4E2A;&#x5173;&#x7CFB;&#x6570;&#x636E;&#x5E93;&#x6765;&#x5B58;&#x50A8;&#x8BA2;&#x5355;&#x3002;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x770B;&#x65B0;&#x7684;&#x8BA2;&#x5355;&#x8D44;&#x6599;&#x5E93;&#x7C7B;&#x8BE5;&#x600E;&#x4E48;&#x7F16;&#x5199;&#x5427;&#xFF1A;</p>
<pre><code class="lang-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DatabaseOrderRepository</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">OrderRepositoryInterface</span> </span>{
    <span class="hljs-keyword">protected</span> $connection;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">connect</span><span class="hljs-params">($username, $password)</span>
    </span>{
        $this-&gt;connection = <span class="hljs-keyword">new</span> DatabaseConnection($username, $password);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">logOrder</span><span class="hljs-params">(Order $order)</span>
    </span>{
        $this-&gt;connection-&gt;run(<span class="hljs-string">&apos;insert into orders values (?, ?)&apos;</span>, <span class="hljs-keyword">array</span>(
            $order-&gt;id, $order-&gt;amount
        ));
    }
}
</code></pre>
<p>Now, let&apos;s examine how we would have to consume this implementation:</p>
<p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x6765;&#x7814;&#x7A76;&#x5982;&#x4F55;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x5B9E;&#x73B0;&#x7C7B;&#xFF1A;</p>
<pre><code class="lang-php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">process</span><span class="hljs-params">(Order $order)</span>
</span>{
    <span class="hljs-comment">// Validate order...</span>

    <span class="hljs-keyword">if</span>($this-&gt;repository <span class="hljs-keyword">instanceof</span> DatabaseOrderRepository)
    {
        $this-&gt;repository-&gt;connect(<span class="hljs-string">&apos;root&apos;</span>, <span class="hljs-string">&apos;password&apos;</span>);
    }
    $this-&gt;repository-&gt;logOrder($order);
}
</code></pre>
<p>Notice that we are forced to check if our OrderRepositoryInterface is a database implementation from within our consuming processor class. If it is, we must connect to the database. This may not seem like a problem in a very small application, but what if the OrderRepositoryInterface is consumed by dozens of other classes? We would be forced to implement this &quot;bootstrap&quot; code in every consumer. This will be a headache to maintain and is prone to bugs, and if we forgot to update a single consumer our application will break.</p>
<p>&#x6CE8;&#x610F;&#x5728;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5FC5;&#x987B;&#x5728;&#x8D44;&#x6599;&#x5E93;&#x5916;&#x90E8;&#x68C0;&#x67E5; OrderRepositoryInterface &#x7684;&#x5B9E;&#x4F8B;&#x5BF9;&#x8C61;&#x662F;&#x4E0D;&#x662F;&#x7528;&#x6570;&#x636E;&#x5E93;&#x5B9E;&#x73B0;&#x7684;&#x3002;&#x5982;&#x679C;&#x662F;&#x7684;&#x8BDD;&#xFF0C;&#x5219;&#x5FC5;&#x987B;&#x5148;&#x8FDE;&#x63A5;&#x6570;&#x636E;&#x5E93;&#x3002;&#x5728;&#x5F88;&#x5C0F;&#x7684;&#x5E94;&#x7528;&#x4E2D;&#x8FD9;&#x53EF;&#x80FD;&#x4E0D;&#x7B97;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#xFF0C;&#x4F46;&#x5982;&#x679C; OrderRepositoryInterface &#x88AB;&#x51E0;&#x5341;&#x4E2A;&#x7C7B;&#x8C03;&#x7528;&#x5462;&#xFF1F;&#x6211;&#x4EEC;&#x53EF;&#x80FD;&#x5C31;&#x8981;&#x628A;&#x8FD9;&#x6BB5;&#x201C;&#x542F;&#x52A8;&#x201D;&#x4EE3;&#x7801;&#x5728;&#x6BCF;&#x4E00;&#x4E2A;&#x8C03;&#x7528;&#x7684;&#x5730;&#x65B9;&#x590D;&#x5236;&#x4E00;&#x904D;&#x53C8;&#x4E00;&#x904D;&#x3002;&#x8FD9;&#x8BA9;&#x4EBA;&#x975E;&#x5E38;&#x5934;&#x75BC;&#x96BE;&#x4EE5;&#x7EF4;&#x62A4;&#xFF0C;&#x975E;&#x5E38;&#x5BB9;&#x6613;&#x51FA;&#x9519;&#x8BEF;&#x3002;&#x4E00;&#x65E6;&#x6211;&#x4EEC;&#x5FD8;&#x4E86;&#x5C06;&#x6240;&#x6709;&#x8C03;&#x7528;&#x7684;&#x5730;&#x65B9;&#x8FDB;&#x884C;&#x540C;&#x6B65;&#x4FEE;&#x6539;&#xFF0C;&#x90A3;&#x7A0B;&#x5E8F;&#x6050;&#x6015;&#x5C31;&#x4F1A;&#x51FA;&#x95EE;&#x9898;&#x3002;</p>
<p>The example above clearly breaks the Liskov Substitution Principle. We were unable to inject an implementation of our interface without changing the consumer to call the connect method. So, now that we have identified the problem, let&apos;s fix it. Here is our new DatabaseOrderRepository implementation:</p>
<p>&#x5F88;&#x660E;&#x663E;&#xFF0C;&#x4E0A;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x6CA1;&#x6709;&#x9075;&#x5FAA;&#x91CC;&#x6C0F;&#x66FF;&#x6362;&#x539F;&#x5219;&#x3002;&#x5982;&#x679C;&#x4E0D;&#x9644;&#x52A0;&#x201C;&#x542F;&#x52A8;&#x201D;&#x4EE3;&#x7801;&#x6765;&#x8C03;&#x7528; connect &#x65B9;&#x6CD5;&#xFF0C;&#x5219;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x5C31;&#x6CA1;&#x6CD5;&#x7528;&#x3002;&#x597D;&#x4E86;&#xFF0C;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x627E;&#x5230;&#x95EE;&#x9898;&#x6240;&#x5728;&#xFF0C;&#x54B1;&#x4EEC;&#x4FEE;&#x597D;&#x4ED6;&#x3002;&#x4E0B;&#x9762;&#x5C31;&#x662F;&#x65B0;&#x7684; DatabaseOrderRepository&#xFF1A;</p>
<pre><code class="lang-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DatabaseOrderRepository</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">OrderRepositoryInterface</span> </span>{
    <span class="hljs-keyword">protected</span> $connector;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">(DatabaseConnector $connector)</span>
    </span>{
        $this-&gt;connector = $connector;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">connect</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-keyword">return</span> $this-&gt;connector-&gt;bootConnection();
    }
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">logOrder</span><span class="hljs-params">(Order $order)</span>
    </span>{
        $connection = $this-&gt;connect();
        $connection-&gt;run(<span class="hljs-string">&apos;insert into orders values (?, ?)&apos;</span>, <span class="hljs-keyword">array</span>(
            $order-&gt;id, $order-&gt;amount
        ));
    }
}
</code></pre>
<p>Now our DatabaseOrderRepository is managing the connection to the database, and we can remove our &quot;bootstrap&quot; code from the consuming OrderProcessor:</p>
<p>&#x73B0;&#x5728; DatabaseOrderRepository &#x638C;&#x7BA1;&#x4E86;&#x6570;&#x636E;&#x5E93;&#x8FDE;&#x63A5;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x628A;&#x201C;&#x542F;&#x52A8;&#x201D;&#x4EE3;&#x7801;&#x4ECE; OrderProcessor &#x79FB;&#x9664;&#x4E86;&#xFF1A;</p>
<pre><code class="lang-php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">process</span><span class="hljs-params">(Order $order)</span>
</span>{
    <span class="hljs-comment">// Validate order...</span>

    $this-&gt;repository-&gt;logOrder($order);
}
</code></pre>
<p>With this modification, we can now use our CsvOrderRepository or DatabaseOrderRepository without modifying the OrderProcessor consumer. Our code adheres to the Liskov Substitution Principle! Take note that many of the architecture concepts we have discussed are related to knowledge. Specifically, the knowledge a class has of its &quot;surrounding&quot;, such as the peripheral code and dependencies that help a class do its job. As you work towards a robust application architecture, limiting class knowledge will be a recurring and important theme.</p>
<p>&#x8FD9;&#x6837;&#x4E00;&#x6539;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x60F3;&#x7528; CsvOrderRepository &#x4E5F;&#x884C;&#xFF0C;&#x60F3;&#x7528; DatabaseOrderRepository &#x4E5F;&#x884C;&#xFF0C;&#x4E0D;&#x7528;&#x6539; OrderProcessor &#x4E00;&#x884C;&#x4EE3;&#x7801;&#x3002;&#x6211;&#x4EEC;&#x7684;&#x4EE3;&#x7801;&#x7EC8;&#x4E8E;&#x5B9E;&#x73B0;&#x4E86;&#x91CC;&#x6C0F;&#x66FF;&#x6362;&#x539F;&#x5219;&#xFF01;&#x8981;&#x6CE8;&#x610F;&#xFF0C;&#x6211;&#x4EEC;&#x8BA8;&#x8BBA;&#x8FC7;&#x7684;&#x8BB8;&#x591A;&#x67B6;&#x6784;&#x6982;&#x5FF5;&#x90FD;&#x548C;&#x77E5;&#x8BC6;&#x76F8;&#x5173;&#x3002;&#x5177;&#x4F53;&#x8BB2;&#xFF0C;&#x77E5;&#x8BC6;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x7C7B;&#x548C;&#x5B83;&#x6240;&#x5177;&#x6709;&#x7684;&#x5468;&#x8FB9;&#x9886;&#x57DF;&#xFF0C;&#x6BD4;&#x5982;&#x7528;&#x6765;&#x5E2E;&#x52A9;&#x7C7B;&#x5B8C;&#x6210;&#x4EFB;&#x52A1;&#x7684;&#x5916;&#x56F4;&#x4EE3;&#x7801;&#x548C;&#x4F9D;&#x8D56;&#x3002;&#x5F53;&#x4F60;&#x8981;&#x5236;&#x4F5C;&#x4E00;&#x4E2A;&#x5BB9;&#x9519;&#x6027;&#x5F3A;&#x5927;&#x7684;&#x5E94;&#x7528;&#x67B6;&#x6784;&#x65F6;&#xFF0C;&#x9650;&#x5236;&#x7C7B;&#x7684;&#x77E5;&#x8BC6;&#x662F;&#x4E00;&#x79CD;&#x5E38;&#x7528;&#x4E14;&#x91CD;&#x8981;&#x7684;&#x624B;&#x6BB5;&#x3002;</p>
<p>Also note the consequence of violating the Liskov Substitution principle with regards to the other principle we have covered. By breaking this principle, the Open Closed principle must also be broken, as, if the consumer must check for instances of various child classes, this consumer must be changed each time there is a new child class.</p>
<p>&#x8FD8;&#x8981;&#x6CE8;&#x610F;&#x5982;&#x679C;&#x4E0D;&#x9075;&#x5B88;&#x91CC;&#x6C0F;&#x66FF;&#x6362;&#x539F;&#x5219;&#xFF0C;&#x90A3;&#x540E;&#x679C;&#x53EF;&#x80FD;&#x4F1A;&#x5F71;&#x54CD;&#x5230;&#x6211;&#x4EEC;&#x4E4B;&#x524D;&#x5DF2;&#x7ECF;&#x8BA8;&#x8BBA;&#x8FC7;&#x7684;&#x5176;&#x4ED6;&#x539F;&#x5219;&#x3002;&#x4E0D;&#x9075;&#x5B88;&#x91CC;&#x6C0F;&#x66FF;&#x6362;&#x539F;&#x5219;&#xFF0C;&#x90A3;&#x4E48;&#x5F00;&#x653E;&#x5C01;&#x95ED;&#x539F;&#x5219;&#x4E00;&#x5B9A;&#x4E5F;&#x4F1A;&#x88AB;&#x6253;&#x7834;&#x3002;&#x56E0;&#x4E3A;&#xFF0C;&#x5982;&#x679C;&#x8C03;&#x7528;&#x8005;&#x5FC5;&#x987B;&#x68C0;&#x67E5;&#x5B9E;&#x4F8B;&#x5C5E;&#x4E8E;&#x54EA;&#x4E2A;&#x5B50;&#x7C7B;&#x7684;&#xFF0C;&#x90A3;&#x4E00;&#x65E6;&#x6709;&#x4E2A;&#x65B0;&#x7684;&#x5B50;&#x7C7B;&#xFF0C;&#x8C03;&#x7528;&#x8005;&#x5C31;&#x5F97;&#x505A;&#x51FA;&#x6539;&#x53D8;&#x3002;&#xFF08;&#x8BD1;&#x8005;&#x6CE8;&#xFF1A;&#x8FD9;&#x5C31;&#x8FDD;&#x80CC;&#x4E86;&#x5BF9;&#x4FEE;&#x6539;&#x5C01;&#x95ED;&#x7684;&#x539F;&#x5219;&#x3002;&#xFF09;</p>
<blockquote>
<h3 id="watch-for-leaks-&#x5C0F;&#x5FC3;&#x9057;&#x6F0F;">Watch For Leaks &#x5C0F;&#x5FC3;&#x9057;&#x6F0F;</h3>
<p>You have probably noticed that this principle is closely related to the avoidance of &quot;leaky abstractions&quot;, which were discussed in the previous chapter. Our database repository&apos;s leaky abstraction was our first clue that the Liskov Substitution Principle was being broken. Keep an eye out for those leaks!</p>
<p>&#x4F60;&#x53EF;&#x80FD;&#x6CE8;&#x610F;&#x5230;&#x8FD9;&#x4E2A;&#x539F;&#x5219;&#x548C;&#x4E0A;&#x4E00;&#x7AE0;&#x8282;&#x63D0;&#x5230;&#x7684;&#x201C;&#x62BD;&#x8C61;&#x7684;&#x6F0F;&#x6D1E;&#x201D;&#x5BC6;&#x5207;&#x76F8;&#x5173;&#x3002;&#x6211;&#x4EEC;&#x7684;&#x6570;&#x636E;&#x5E93;&#x8D44;&#x6599;&#x5E93;&#x7684;&#x62BD;&#x8C61;&#x6F0F;&#x6D1E;&#x5C31;&#x662F;&#x6CA1;&#x6709;&#x9075;&#x5B88;&#x91CC;&#x6C0F;&#x66FF;&#x6362;&#x539F;&#x5219;&#x7684;&#x7B2C;&#x4E00;&#x8FF9;&#x8C61;&#x3002;&#x8981;&#x7559;&#x610F;&#x90A3;&#x4E9B;&#x6F0F;&#x6D1E;&#xFF01;</p>
</blockquote>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="10.1_Introduction.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page: 10.1 Introduction 介绍">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"10.2 In Action 实践","level":"1.12.2","depth":2,"next":{"title":"11 Interface Segregation Principle 接口隔离原则","level":"1.13","depth":1,"ref":"","articles":[{"title":"11.1 Introduction 介绍","level":"1.13.1","depth":2,"path":"chapters/11.1_Introduction.md","ref":"./chapters/11.1_Introduction.md","articles":[]},{"title":"11.2 In Action 实践","level":"1.13.2","depth":2,"path":"chapters/11.2_In_Action.md","ref":"./chapters/11.2_In_Action.md","articles":[]}]},"previous":{"title":"10.1 Introduction 介绍","level":"1.12.1","depth":2,"path":"chapters/10.1_Introduction.md","ref":"./chapters/10.1_Introduction.md","articles":[]},"dir":"ltr"},"config":{"plugins":[],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","author":"original Taylor Otwell, translate zgldh","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"Laravel - 从百草园到三味书屋","language":"zh-hans","gitbook":"*"},"file":{"path":"chapters/10.2_In_Action.md","mtime":"2019-01-07T14:18:36.132Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2019-01-07T16:06:05.085Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

